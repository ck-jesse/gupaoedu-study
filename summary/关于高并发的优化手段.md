
# 高并发的优化手段
## 架构层面
1、服务化
> 按业务或功能拆分服务

2、数据库
> 分库分表，读写分离

3、存储
> Redis，ES支撑复杂查询
>
4、服务无状态化设计
> 便于水平扩展,自动扩缩容
>
5、缓存
> 本地缓存，分布式缓存，二级缓存，DNS缓存，浏览器缓存等。
>
> 应对热点数据、秒杀、静态页面等场景。
> 
6、容量规划
> 单机瓶颈，PV(Page View)，UV(User View)
>
> 单接口压测 / 链路压测
>
> 压测 -> 关注指标（QPS/CPU/内存） -> 容量规划 -> 机器数量（扩缩容）
>> 注：压测一定要有目标
>
7、异步化
> 消息队列，异步解耦，流量削峰。
>
8、冗余
> 分区副本，如kafka中partition的多副本机制。
>

## 代码层面
> 1、DB层面，SQL优化，索引优化
>
> 2、异步化，线程池的使用
>
> 3、池化技术，线程池，连接池
>
> 4、内存是有的优化，弱引用、软引用、强引用
>
> 5、事务大小
>
> 6、缓存，本地缓存+分布式缓存
> 
> 7、调用链路优化，减少不必要的调用。
>
> 8、容错
>
> 9、限流
>
> 10、复杂业务的重构，使其便于扩展，便于维护。
>
## 负载均衡
负载均衡将是大型网站解决高负荷访问和大量并发请求采用的终极解决办法。


二层负载
> 基于mac地址
>
三层负载
> IP层
>
四层负载
> IP+Port, F5/LVS/Nginx
> 
> 硬负载
> 
> F5,第四层交换功能就象是虚IP，指向物理服务器。它传输的业务服从的协议多种多样，有HTTP、FTP、NFS、Telnet或其他协议。这些业务在物理服务器基础上，需要复杂的载量平衡算法。
>
> 软负载
>
> 软件四层交换我们可以使用Linux上常用的LVS来解决，LVS就是Linux Virtual Server，他提供了基于心跳线heartbeat的实时灾难应对解决方案，提高系统的鲁棒性，同时可供了灵活的虚拟VIP配置和管理功能，可以同时满足多种应用需求，这对于分布式的系统来说必不可少。
>
七层负载
> http协议(URI) / 应用层负载
>
> 网关 通过URI来分发请求；Robbin 应用层负载。