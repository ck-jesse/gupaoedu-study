# 什么是架构？
架构体现的是整体结构和组件之间的关系。

注：架构设计的主要目的是为了解决当下或未来软件系统复杂度带来的问题，而架构其实并非设计出来，而是随着业务的发展逐步演变出来的结果。

# 架构的本质
1、架构的本质是管理复杂性。

2、对系统进行有序化重构，使系统不断进化，以符合当前业务的发展，并可快速扩展。

管理复杂性的主要手段是拆分和集成：
> 把复杂系统拆分成模块，似乎并没有降低整个系统的复杂度。它降低的只是子系统的复杂度。而整个系统的复杂度，反而会由于拆分后的模块之间，不得不进行交互，变得更加复杂。

# 架构的过程
架构的过程其实就是`建模`的过程。

从现实世界到业务模型，从业务模型到概念模型，从概念模型到设计模型，通过不断的`抽象`去粗取精，形成对现实世界的层层抽象，所以架构的过程其实就是`建模`的过程。

> 建模 -> 抽象 -> 模块化 -> 分层 -> 集成 

## 建模
模是什么？
> 简单来讲模就是业务的映射，这个映射的结果是业务模型、概念模型或设计模型。

如何建？
> 建模的本质其实一个`抽象`的过程。


### 业务建模
业务建模是为了完成从现实世界到业务模型的构建。

业务架构图的核心目的是统一共识、减少沟通成本，无论是项目中的哪个角色大家都能讲一样的话，描述一样的事情。

> 业务、产品、测试、研发，大家都能讲一样的话，描述一样的事情。

### 系统建模
“剥洋葱式”的由大到小，由粗到细，覆盖所有已知和未来可能业务场景；善于利用各种模型表述：自然语言、关系模型、时序图、状态图、流程图、各种层次架构图等等进行模型表述，充分表达各种业务场景并不断验证。
核心实体抽取：抓住核心概念，核心关系完成核心模型建立。

> 一个笑话：一位女士对老公说：把袋子里的土豆削一半下锅；结果所有土豆都下锅了，而且每个土豆被削了一半。
>
> 这里其实就没有清晰的设别主体，这个主体不单是土豆，而是隐含的人要吃土豆，包括人和土豆两个实体，这两个实体之间的关系就是要解决的业务场景：怎样吃？如何吃？为什么吃？所以主体识别不清楚，可能会导致整体实现的偏离。从侧面说明核心实体的抽取是非常关键的。
>
> 

### 抽象
抽象的本质：个性、共性？

如何抽象？

抽象层次越高，细节越少，稳定性越高，普适性越强，可重用性就越高。

> 抽象有两种方法，一种是自顶向下，另一种是自底向上。
> 
> 业务建模，是从小到大，从局部到整体，自底向上的归纳、演绎的抽象过程。
> 
> 系统建模，是从大到小，从整体到局部，自顶向下的拆解、切分的抽象过程。
> 
> 但不绝对，自上而下和自下而上，往往在过程中是随意切换的。

较低层次的抽象：
> 应用内部包图、类图；某个领域：实体图、时序图、状态图、用例图等等。

较高层次的抽象：
> 具有一定的复杂性，比如微服务架构，系统间的交互图，领域/子领域架构图，整个系统架构图等等。


# 什么是架构图
架构图 = 架构 + 图 = 表达架构的图

架构图的作用：解决沟通障碍，提升协作效率。

## 架构的目标
1、高内聚、低耦合
2、可扩展
3、可靠性
4、可维护

# 什么是架构师

这是来自于阿白老师的文章《架构师到底是做什么的？》，越是琢磨，越觉得深以为然。

其中提到了好的架构师的画像和不好的画像，如下图，与大家共勉：

![架构师是做什么的](D:\gitee\gupaoedu-study\summary\img\架构师是做什么的.jpg)

从我个人的成长经历看，架构师很重要的一点要学会“权衡”，既要兼顾当下痛点也要符合未来一定时间的发展，既要保留未来的可扩展性也要避免过度设计。

选择什么样的时间节点、什么样的业务场景以及什么样的架构迭代策略至关重要，这些决策的关键在于判断和取舍，需要结合深刻的业务思考乃至组织架构去做权衡落地。



参考

[阿里技术专家：如何画好一张架构图？]: https://mp.weixin.qq.com/s/zo0JGquMxCDTkFrFk2kBgw



# 重构的面和点

1、开发、测试、上线的流程
2、技术文档积累
3、微服务标准化
4、业务拆分
5、代码抽象设计，模块化/分层/灵活性/可扩展性
6、服务CI、CD
7、容器化K8S+Istio服务治理

重构是通过调整程序代码改善软件的质量、性能，使程序的设计和架构更加合理，提供软件的扩展性和维护性。

# 幂等设计
1、状态机幂等
2、数据库唯一约束（兜底策略）
3、token



重构可以矫正技术负债。重构的关键是它能改善代码设计，结构和可读性（因而减少代码负债），但是它不能改变代码的行为。

重构规划：总体规划，分步实施。
中长期规划：
量化目标：
1、单体升级微服务，解耦，模块化，服务化
2、代码质量提升
3、性能提升
4、架构更合理
5、设计更合理
6、可扩展性提升
7、可维护性提升
8、稳定性提升，系统可用率从现在多少提升到多少？
9、提升公司的基础能力建设
10、聚焦力量把关键技术关键业务做深做厚
11、业务协同，业务侧提供一个衡量指标，提升成单率
12、

重构规划：（周期：5个月）
1、一期（3周：1周梳理，2周开发）
B端：库存变更相关
C端：下单主流程、商品详情、商品列表、购物车
目标：QPS/TPS
2、二期（3周：1周梳理，2周开发）
C端：所有C端商品相关、解决缓存使用混乱问题。以及涉及到的B端相关的功能。
3、三期（3周：1周梳理，2周开发）
B端：新增/修改商品相关：导入商品、脚本同步商品、第三方同步商品，以及涉及到的C端相关功能。
4、四期（5周：1周梳理，4周开发）
B端：将商品相关所有的功能都收敛起来进行重构，
DB：DB拆分，从原DB中独立出来。